(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{199:function(t,e,o){"use strict";var n={props:["pagination"],methods:{goPage:function(t){this.$emit("gopage",t)}}},l=o(3),component=Object(l.a)(n,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("nav",{staticClass:"mt-3"},[o("ul",{staticClass:"pagination d-flex justify-content-center"},[o("li",{staticClass:"page-item",class:{disabled:!t.pagination.has_pre}},[o("a",{staticClass:"page-link",attrs:{href:"#","aria-label":"Previous"},on:{click:function(e){return e.preventDefault(),t.goPage(t.pagination.current_page-1)}}},[o("span",{attrs:{"aria-hidden":"true"}},[t._v("«")])])]),t._v(" "),t._l(t.pagination.total_pages,(function(e){return o("li",{key:e,staticClass:"page-item",class:{active:t.pagination.current_page===e},on:{click:function(o){return o.preventDefault(),t.goPage(e)}}},[o("a",{staticClass:"page-link",attrs:{href:"#"}},[t._v(t._s(e))])])})),t._v(" "),o("li",{staticClass:"page-item",class:{disabled:!t.pagination.has_next}},[o("a",{staticClass:"page-link",attrs:{href:"#","aria-label":"Next"},on:{click:function(e){return e.preventDefault(),t.goPage(t.pagination.current_page+1)}}},[o("span",{attrs:{"aria-hidden":"true"}},[t._v("»")])])])],2)])}),[],!1,null,null,null);e.a=component.exports},204:function(t,e,o){"use strict";(function(t){var n=o(2),l=o.n(n),c=o(199);e.a={middleware:"Auth",meta:{requiresAuth:!0},layout:"admin",components:{pagination:c.a},data:function(){return{coupons:[],pagination:{},tempCoupon:{},tempTimestamp:""}},computed:{isLoading:function(){return this.$store.state.isLoading},isNew:function(){return this.$store.state.isNew}},created:function(){this.getCouponsData()},methods:{getCouponsData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=this;e.$store.dispatch("updateLoading",!0);var o="".concat("https://vue-course-api.hexschool.io","/api/").concat("komu","/admin/coupons?page=").concat(t);l.a.get(o).then((function(t){console.log("後台取得Coupons資料：",t),e.coupons=t.data.coupons,e.pagination=t.data.pagination,e.$store.dispatch("updateLoading",!1)}))},updateCoupon:function(){var e=this;e.$store.dispatch("updateLoading",!0);var o="".concat("https://vue-course-api.hexschool.io","/api/").concat("komu","/admin/coupon"),n="post";e.isNew||(o="".concat("https://vue-course-api.hexschool.io","/api/").concat("komu","/admin/coupon/").concat(e.tempCoupon.id),n="put"),e.formatTimestamp(e.tempCoupon.due_date);var c=e.tempCoupon;l.a[n](o,{data:c}).then((function(o){o.data.success?(console.log("updateCoupon:",o),e.$store.dispatch("updateLoading",!1),t("#couponModal").modal("hide"),e.getCouponsData()):(console.log("更新coupon失敗",o),e.$store.dispatch("updateLoading",!1),t("#couponModal").modal("hide"))}))},removeCoupon:function(){var e=this;e.$store.dispatch("updateLoading",!0);var o="".concat("https://vue-course-api.hexschool.io","/api/").concat("komu","/admin/coupon/").concat(e.tempCoupon.id);l.a.delete(o).then((function(o){console.log("deleteCoupons:",o),e.$store.dispatch("updateLoading",!1),o.data.success||console.log(o.data.message),t("#delcouponModal").modal("hide"),e.getCouponsData()}))},openModal:function(e,o,n){if(e)this.tempCoupon={},this.tempTimestamp="",this.$store.dispatch("updateisNew",!0);else{if(!e&&n)return this.tempCoupon=Object.assign({},o),void t("#delcouponModal").modal("show");this.tempCoupon=Object.assign({},o),this.formatTime(this.tempCoupon.due_date),this.$store.dispatch("updateisNew",!1)}t("#couponModal").modal("show")},formatTime:function(t){var e=new Date(1e3*t),o=e.getFullYear(),n=e.getMonth()<10?"0".concat(e.getMonth()+1):e.getMonth()+1,l=e.getDate()<10?"0".concat(e.getDate()):e.getDate();this.tempCoupon.due_date="".concat(o,"-").concat(n,"-").concat(l),console.log("formatTime:",this.tempCoupon.due_date)},formatTimestamp:function(t){var e=new Date(t);this.tempCoupon.due_date=Math.floor(e.getTime()/1e3),console.log("formatTimestamp:",this.tempCoupon.due_date)}}}}).call(this,o(42))},248:function(t,e,o){"use strict";o.r(e);var n=o(204).a,l=o(3),component=Object(l.a)(n,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("loading",{attrs:{active:t.isLoading},on:{"update:active":function(e){t.isLoading=e}}}),t._v(" "),o("div",{staticClass:"text-right py-3"},[o("button",{staticClass:"btn btn-large btn-secondary",on:{click:function(e){return e.preventDefault(),t.openModal(!0)}}},[t._v("\n      新建Coupon\n    ")])]),t._v(" "),o("table",{staticClass:"table"},[t._m(0),t._v(" "),o("tbody",t._l(t.coupons,(function(e){return o("tr",{key:e.id},[o("td",[t._v(t._s(e.title))]),t._v(" "),o("td",[t._v(t._s(e.code))]),t._v(" "),o("td",[t._v(t._s(t._f("formatTime")(e.due_date)))]),t._v(" "),o("td",[t._v("\n          "+t._s(e.percent)+"\n          ")]),t._v(" "),o("td",[o("a",{staticClass:"btn btn-outline-primary btn-sm",attrs:{href:"#"},on:{click:function(o){return o.preventDefault(),t.openModal(!1,e)}}},[t._v("編輯")]),t._v(" "),o("a",{staticClass:"btn btn-outline-danger btn-sm",attrs:{href:"#"},on:{click:function(o){return o.preventDefault(),t.openModal(!1,e,!0)}}},[t._v("刪除")])])])})),0)]),t._v(" "),o("pagination",{attrs:{pagination:t.pagination},on:{gopage:t.getCouponsData}}),t._v(" "),o("div",{staticClass:"modal fade",attrs:{id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true"}},[o("div",{staticClass:"modal-dialog modal-lg",attrs:{role:"document"}},[o("div",{staticClass:"modal-content border-0"},[o("div",{staticClass:"modal-header bg-dark text-white"},[o("h5",{staticClass:"modal-title",attrs:{id:"couponModalLabel"}},[t.isNew?o("span",[t._v("新增Coupon")]):t._e(),t._v(" "),t.isNew?t._e():o("span",[t._v("編輯Coupon")])]),t._v(" "),t._m(1)]),t._v(" "),o("div",{staticClass:"modal-body"},[o("div",{staticClass:"row"},[o("div",{staticClass:"col-sm-12"},[o("div",{staticClass:"form-group"},[o("label",{attrs:{for:"title"}},[t._v("標題")]),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.tempCoupon.title,expression:"tempCoupon.title"}],staticClass:"form-control",attrs:{id:"title",type:"text",placeholder:"請輸入標題"},domProps:{value:t.tempCoupon.title},on:{input:function(e){e.target.composing||t.$set(t.tempCoupon,"title",e.target.value)}}})]),t._v(" "),o("div",{staticClass:"form-row"},[o("div",{staticClass:"form-group col-md-12"},[o("label",{attrs:{for:"category"}},[t._v("折數")]),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.tempCoupon.percent,expression:"tempCoupon.percent"}],staticClass:"form-control",attrs:{id:"category",type:"number",placeholder:"請輸入折數"},domProps:{value:t.tempCoupon.percent},on:{input:function(e){e.target.composing||t.$set(t.tempCoupon,"percent",e.target.value)}}})]),t._v(" "),o("div",{staticClass:"form-group col-md-12"},[o("label",{attrs:{for:"price"}},[t._v("折扣碼")]),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.tempCoupon.code,expression:"tempCoupon.code"}],staticClass:"form-control",attrs:{id:"unit",type:"unit",placeholder:"請輸入折扣碼"},domProps:{value:t.tempCoupon.code},on:{input:function(e){e.target.composing||t.$set(t.tempCoupon,"code",e.target.value)}}})]),t._v(" "),o("div",{staticClass:"form-group col-md-12"},[o("label",{attrs:{for:"origin_price"}},[t._v("到期日")]),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.tempCoupon.due_date,expression:"tempCoupon.due_date"}],staticClass:"form-control",attrs:{id:"origin_price",type:"date",placeholder:"請輸入到期日"},domProps:{value:t.tempCoupon.due_date},on:{input:function(e){e.target.composing||t.$set(t.tempCoupon,"due_date",e.target.value)}}})])])])])]),t._v(" "),o("div",{staticClass:"modal-footer"},[o("button",{staticClass:"btn btn-outline-secondary",attrs:{type:"button","data-dismiss":"modal"}},[t._v("\n            取消\n          ")]),t._v(" "),o("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:function(e){return e.preventDefault(),t.updateCoupon(e)}}},[t.isLoading?o("i",{staticClass:"fas fa-spinner fa-spin"}):t._e(),t._v("確認\n          ")])])])])]),t._v(" "),o("div",{staticClass:"modal fade",attrs:{id:"delcouponModal",tabindex:"-1",role:"dialog"}},[o("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[o("div",{staticClass:"modal-content border-0"},[t._m(2),t._v(" "),o("div",{staticClass:"modal-body"},[t._v("\n          是否刪除 "+t._s(t.tempCoupon.title)+" Coupon。\n          "),o("strong",{staticClass:"text-danger"},[t._v("(刪除後將無法恢復)")])]),t._v(" "),o("div",{staticClass:"modal-footer"},[o("button",{staticClass:"btn btn-outline-secondary",attrs:{type:"button","data-dismiss":"modal"}},[t._v("\n            取消\n          ")]),t._v(" "),o("button",{staticClass:"btn btn-danger",attrs:{type:"button"},on:{click:function(e){return e.preventDefault(),t.removeCoupon(e)}}},[t._v("\n            確認刪除\n          ")])])])])])],1)}),[function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("thead",{staticClass:"thead-light"},[o("tr",[o("th",{attrs:{scope:"col"}},[t._v("\n          Coupon名稱\n        ")]),t._v(" "),o("th",{attrs:{scope:"col",width:"200"}},[t._v("\n          Coupon Code\n        ")]),t._v(" "),o("th",{attrs:{scope:"col",width:"110"}},[t._v("\n          截止日\n        ")]),t._v(" "),o("th",{attrs:{scope:"col",width:"80"}},[t._v("\n          折數\n        ")]),t._v(" "),o("th",{attrs:{scope:"col",width:"130"}},[t._v("\n          編輯\n        ")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[e("span",{attrs:{"aria-hidden":"true"}},[this._v("×")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"modal-header bg-danger text-white"},[e("h5",{staticClass:"modal-title",attrs:{id:"delcouponModalLabel"}},[e("span",[this._v("刪除Coupon")])]),this._v(" "),e("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[e("span",{attrs:{"aria-hidden":"true"}},[this._v("×")])])])}],!1,null,null,null);e.default=component.exports}}]);